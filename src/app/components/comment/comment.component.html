<mat-card *ngIf="!deleted">
    <mat-card-header>
        <img mat-card-avatar [src]="user.images.avatarUrl ?? placeholderImg" onerror="this.src=='placeholderImg'"
            alt="profile picture">
        <mat-card-title>{{user.data.username ?? 'Guest'}}</mat-card-title>

        <mat-card-subtitle>
            {{comment.createdAt | date:'dd-MM-yyyy'}}
            <span *ngIf="comment.isEdited">(Edited: {{comment.editedAt | date:'dd-MM-yyyy'}})</span>
        </mat-card-subtitle>

        <div class="menu">
            <button mat-icon-button [matMenuTriggerFor]="menu">
                <mat-icon>more_vert</mat-icon>
            </button>
        </div>
    </mat-card-header>

    <mat-card-content>
        <span *ngIf="!editMode">{{comment.message}}</span>
        <input matInput *ngIf="editMode" type="text" [(ngModel)]="editedMessage">
    </mat-card-content>

    <mat-card-actions *ngIf="!editMode" class="votes">
        <button mat-icon-button [color]="upvoted ? 'warn' : 'basic'"
            (click)="upvote()"><mat-icon>thumb_up</mat-icon></button>
        <span>{{comment.votes}}</span>
        <button mat-icon-button [color]="downvoted ? 'primary' : 'basic'"
            (click)="downvote()"><mat-icon>thumb_down</mat-icon></button>
    </mat-card-actions>

    <mat-card-actions *ngIf="editMode" class="actions">
        <button mat-stroked-button color="basic" (click)="cancel()">Discard changes</button>
        <button mat-stroked-button color="primary" (click)="edit()">Apply changes</button>
    </mat-card-actions>
</mat-card>

<mat-menu #menu>
    <button mat-menu-item [disabled]="editMode" (click)="editMode = true">
        <mat-icon>edit</mat-icon>
        <span>Edit</span>
    </button>
    <button mat-menu-item [disabled]="editMode" (click)="delete()">
        <mat-icon>delete</mat-icon>
        <span>Delete</span>
    </button>
</mat-menu>